import{r,a1 as C,aA as I,j as e,aG as R,aH as B,aI as H,B as v,z as L,aJ as z,a2 as M}from"./index-DslgdRtL.js";import{N as T,P as U}from"./NoPosts-1Qe_e2Hh.js";import{u as V}from"./index-DwPHSqNx.js";import{S as l}from"./OverlayLoader-ur8Wszvy.js";import"./badge-DbXobgV4.js";import"./HeartIcon-DZkMg670.js";import"./DreamPersonalityTypes-BqBoWeLo.js";import"./pencil-DOzFfULB.js";import"./trash-2-BJNP8_Sh.js";function X(){const[i,p]=r.useState([]),[n,h]=r.useState(1),[c,b]=r.useState(!0),[f,u]=r.useState(!1),[g,m]=r.useState(null),{ref:P,inView:y}=V(),S=C(),{filters:s}=I(),j=async(t=n)=>{var o,x;u(!0),m(null);const a=new URLSearchParams({sort:s.sortOption,search:s.searchQuery,likedOnly:s.likedOnly.toString()});if(s.mood.length&&a.append("mood",s.mood.join(",")),s.personalityType.length&&a.append("dream_personality_type",s.personalityType.join(",")),(o=s.date)!=null&&o.from&&a.append("from",s.date.from.toISOString()),(x=s.date)!=null&&x.to){const d=new Date(s.date.to);d.setHours(23,59,59,999),a.append("to",d.toISOString())}try{const d={page:t,limit:10},E=await S.get(`community/post?${a}`,{params:d}),{posts:N,currentPage:O,totalPages:_}=E.data;p(D=>t===1?N:[...D,...N]),b(O<_)}catch{m("Unable to load posts."),M.error("Failed to fetch posts. Please try again.",{description:"Please check your connection and try again later."})}finally{u(!1)}};r.useEffect(()=>{(c||n===1)&&j(n)},[n,s]),r.useEffect(()=>{h(1)},[s]),r.useEffect(()=>{y&&c&&h(t=>t+1)},[y,c]);const k=()=>{m(null),j(n)},A=t=>{p(a=>a.map(o=>o._id===t._id?t:o))},w=()=>e.jsxs("div",{className:"w-full bg-white rounded-xl shadow-sm p-4 animate-pulse",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx(l,{className:"w-10 h-10 rounded-full bg-gray-300"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{className:"h-4 w-32 bg-gray-300 mb-2"}),e.jsx(l,{className:"h-3 w-24 bg-gray-200"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"h-4 w-3/4 bg-gray-300"}),e.jsx(l,{className:"h-4 w-full bg-gray-200"}),e.jsx(l,{className:"h-4 w-5/6 bg-gray-300"})]}),e.jsx("div",{className:"mt-4 pt-3 border-t",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx(l,{className:"h-8 w-20 bg-gray-300 rounded-md"}),e.jsx(l,{className:"h-8 w-20 bg-gray-300 rounded-md"})]})})]});return e.jsxs("div",{className:"w-full flex flex-col items-center relative p-4",children:[g&&e.jsxs(R,{className:"w-full max-w-xl mb-4 bg-red-50 border border-red-200 text-red-800 rounded-xl shadow-sm p-4 flex items-start gap-3",children:["âŒ",e.jsxs("div",{className:"flex-1",children:[e.jsx(B,{className:"font-semibold",children:"Something went wrong"}),e.jsxs(H,{className:"text-sm",children:[g,e.jsx(v,{variant:"link",size:"sm",onClick:k,className:"ml-1 text-sm text-red-700",children:"Retry"})]})]})]}),f&&i.length===0?e.jsx("div",{className:"grid grid-cols-1 gap-4 w-full max-w-xl",children:[1,2,3].map(t=>e.jsx(w,{},t))}):i.length===0?e.jsxs(L.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"text-muted-foreground text-sm text-center py-8 flex flex-col items-center",children:[e.jsx(z,{animationData:T,loop:!0,autoplay:!0,style:{height:"300px",width:"300px"}}),e.jsx("p",{children:"ðŸ’­ No Posts yet. Be the first to post!"}),e.jsx(v,{onClick:()=>m(null)||h(1),variant:"secondary",className:"mt-2 ",children:"Refresh"})]}):e.jsx("div",{className:"grid grid-cols-1 gap-6 w-full max-w-xl",children:i.map(t=>e.jsx("div",{className:"animate-fade-in-up transition-all duration-500",children:e.jsx(U,{post:t,updatePost:A,onDelete:a=>p(o=>o.filter(x=>x._id!==a))})},t._id))}),f&&i.length>0&&e.jsx("div",{className:"w-full max-w-xl mt-6",children:e.jsx(w,{})}),!f&&c&&e.jsx("div",{ref:P,className:"h-4 w-full"}),!c&&i.length>0&&e.jsx("p",{className:"mt-6 text-gray-500",children:"â€” You've reached the end â€”"})]})}export{X as default};
