import{r as a,a1 as I,j as e,B as T,aB as _,ac as H,_ as $,z,aC as A,aD as F,a2 as P,a3 as B,a4 as L,ad as q,ae as M,af as W,u as K,aE as R,aF as V}from"./index-DslgdRtL.js";import{D as U,a as Y,b as G,c as J,d as Q,e as X}from"./drawer-CburzjCZ.js";import{T as Z}from"./textarea-93_9_elS.js";import{H as ee,a as te,b as ae}from"./hover-card-DgRLNneX.js";import{u as se}from"./index-DwPHSqNx.js";import{T as re,a as ie,b as E}from"./tabs-DRbOuz6z.js";const le=({selectedDream:n,setSelectedDream:g})=>{const[o,p]=a.useState(""),[c,S]=a.useState(""),[i,f]=a.useState(!1),[d,x]=a.useState([]),[l,m]=a.useState(1),[u,j]=a.useState(!0),[h,v]=a.useState(!1),{ref:D,inView:b}=se(),k=I();a.useEffect(()=>{const t=setTimeout(()=>{S(o)},500);return()=>clearTimeout(t)},[o]),a.useEffect(()=>{i&&(x([]),m(1),j(!0),y(1,c))},[c,i]),a.useEffect(()=>{b&&u&&!h&&i&&l>1&&y(l,c)},[b,u,h,i,l]),a.useEffect(()=>{i?y(1,c):(x([]),m(1),j(!0))},[i]),a.useEffect(()=>{b&&u&&!h&&d.length>0&&m(t=>t+1)},[b,u,h,d.length]);const y=async(t,s)=>{if(!h)try{v(!0);const r=await k.get(`/dream/getdreams?page=${t}${s?`&search=${encodeURIComponent(s)}`:""}`),N=new Set(d.map(w=>w._id)),O=r.data.dreams.filter(w=>!N.has(w._id));x(t===1?r.data.dreams:w=>[...w,...O]),j(r.data.currentPage<r.data.totalPages)}catch(r){console.error("Error fetching dreams:",r)}finally{v(!1)}},C=t=>{g(t),f(!1)};return e.jsxs(B,{open:i,onOpenChange:f,children:[e.jsx(L,{asChild:!0,children:e.jsx("div",{className:"flex items-center gap-2 border border-gray-300 rounded-md px-3 py-2 cursor-pointer hover:border-blue-500 transition-colors",children:n?e.jsxs(ee,{children:[e.jsx(te,{asChild:!0,children:e.jsx("span",{className:"font-semibold text-blue-600",children:n.title})}),e.jsx(ae,{className:"p-4 text-gray-700",children:n.description})]}):e.jsx("span",{className:"text-gray-500",children:"Select a Dream..."})})}),e.jsxs(q,{className:"sm:max-w-md",children:[e.jsx(M,{children:e.jsx(W,{children:"Select a Dream"})}),e.jsxs("div",{className:"p-2",children:[e.jsx(H,{placeholder:"Search dreams...",value:o,onChange:t=>p(t.target.value),className:"mb-3"}),e.jsxs("div",{className:"max-h-64 overflow-y-auto border border-gray-200 rounded-md",style:{overscrollBehavior:"contain",WebkitOverflowScrolling:"touch"},children:[h&&d.length===0&&e.jsx("div",{className:"flex justify-center p-4",children:e.jsx(F,{className:"animate-spin text-gray-500",size:20})}),!h&&d.length===0&&e.jsx("div",{className:"text-sm text-gray-400 p-3",children:"No dreams found."}),d.length>0&&e.jsxs(e.Fragment,{children:[d.map((t,s)=>{const r=t._id?`${t._id}-${s}`:`index-${s}`;return e.jsxs("div",{ref:s===d.length-1?D:null,onClick:()=>C(t),className:"px-3 py-2 hover:bg-blue-50 cursor-pointer transition-colors border-b border-gray-100 last:border-b-0",children:[e.jsx("div",{className:"font-semibold text-gray-800",children:t.title}),e.jsx("div",{className:"text-xs text-gray-500 line-clamp-1",children:t.description})]},r)}),h&&e.jsx("div",{className:"flex justify-center p-2",children:e.jsx(F,{className:"animate-spin text-gray-500",size:16})})]})]})]})]})]})},ne=()=>{const[n,g]=a.useState(null),[o,p]=a.useState(""),[c,S]=a.useState(""),[i,f]=a.useState([]),[d,x]=a.useState(!1),[l,m]=a.useState({}),[u,j]=a.useState(!1),[h,v]=a.useState(!1),D=I(),b=t=>{if(t.key===" "&&t.target.value.trim()){const s=t.target.value.trim();if(s.length>20){m(r=>({...r,hashtags:"Hashtags must be 20 characters or less."}));return}f([...i,s]),t.target.value="",m(r=>({...r,hashtags:""}))}},k=t=>{f(i.filter((s,r)=>r!==t))},y=a.useCallback(()=>{let t={};return n||(t.selectedDream="Please select a dream."),c.trim()?c.trim().length<5?t.title="Title must be at least 5 characters.":c.trim().length>30&&(t.title="Title must be less than 30 characters."):t.title="Title is required.",o.trim()?o.trim().split(/\s+/).length<10?t.caption="Caption must be at least 10 words.":o.trim().split(/\s+/).length>120&&(t.caption="Caption must be less than 120 words."):t.caption="Caption is required.",i.forEach(s=>{s.length>20&&(t.hashtags="Hashtags must be 20 characters or less.")}),t},[n,o,i]),C=async t=>{t.preventDefault();const s=y();if(j(!0),Object.keys(s).length>0){m(s);return}x(!0);try{const r=await D.post("community/post",{dreamId:n._id,caption:o,title:c,hashtags:i});g(null),p(""),f([]),m({}),j(!1),P.success("ðŸŽ‰ Post created successfully!",{description:"You can now view it in Community Section.",duration:4e3,dismissible:!0}),v(!1)}catch(r){console.error("Error creating post:",r),err!=null&&err.response?(P.warning("âš ï¸ Something went wrong",{description:"Please try again.",duration:5e3,dismissible:!0}),m(N=>({...N,general:"Failed to create post. Try again."}))):(P.error("âŒ Failed to add post!",{description:"Check your internet connection and try again.",duration:6e3,dismissible:!0}),m(N=>({...N,general:"No server response. Please check your internet."})))}finally{x(!1)}};return e.jsxs(U,{open:h,onOpenChange:v,children:[e.jsx(Y,{asChild:!0,children:e.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:e.jsxs(T,{className:"relative group overflow-hidden flex items-center justify-center bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-full h-12 w-12 shadow-lg transition-all duration-300 ease-in-out hover:w-40 hover:rounded-full",children:[e.jsx("span",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(_,{size:20,className:"group-hover:absolute group-hover:right-4 transition-all duration-300"})}),e.jsx("span",{className:"opacity-0 group-hover:opacity-100 text-lg absolute left-6 transition-opacity duration-300 whitespace-nowrap",children:"Add a post"})]})})}),e.jsx(G,{className:"p-0 bg-gradient-to-br from-indigo-50 to-pink-50 dark:from-gray-800 dark:to-gray-700 rounded-t-xl shadow-2xl max-h-[90vh]",children:e.jsx("div",{className:"w-full h-full overflow-y-auto",children:e.jsxs("div",{className:"p-6 w-full max-w-md mx-auto",children:[e.jsxs(J,{children:[e.jsx(Q,{className:"text-3xl font-bold text-gray-800 dark:text-gray-100",children:"Create New Post"}),e.jsx(X,{className:"text-sm text-gray-600 dark:text-gray-300",children:"Share your dream with the community."})]}),e.jsxs("form",{onSubmit:C,className:"pt-4 space-y-5",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Select Dream"}),e.jsx(le,{selectedDream:n,setSelectedDream:g}),u&&l.selectedDream&&e.jsx("p",{className:"text-red-500 text-sm",children:l.selectedDream}),e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Title"}),e.jsx(H,{value:c,onChange:t=>S(t.target.value),className:"w-full border rounded-md p-2"}),u&&l.title&&e.jsx("p",{className:"text-red-500 text-sm",children:l.title}),e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Caption"}),e.jsx(Z,{value:o,onChange:t=>p(t.target.value),className:"w-full border rounded-md p-2"}),u&&l.caption&&e.jsx("p",{className:"text-red-500 text-sm",children:l.caption}),e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Hashtags"}),e.jsxs("div",{className:"border rounded-md p-2",children:[e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:e.jsx($,{children:i.map((t,s)=>e.jsxs(z.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"bg-blue-500 text-white px-3 py-1 rounded-full flex items-center gap-2",children:[t,e.jsx(A,{className:"cursor-pointer",onClick:()=>k(s)})]},s))})}),e.jsx(H,{placeholder:"Type and press space...",onKeyDown:b,className:"border-none focus:ring-0 w-full"}),u&&l.hashtags&&e.jsx("p",{className:"text-red-500 text-sm",children:l.hashtags})]}),u&&l.general&&e.jsx("p",{className:"text-red-500 text-sm",children:l.general}),e.jsxs("div",{className:"flex justify-end space-x-3 pb-4 mt-8",children:[e.jsx(T,{variant:"outline",type:"button",onClick:()=>v(!1),children:"Cancel"}),e.jsx(T,{type:"submit",disabled:d,children:d?e.jsx(F,{className:"animate-spin"}):"Post"})]})]})]})})})]})};function oe({currentPath:n}){const g=K(),o=n.endsWith("/all-posts")?"all":n.endsWith("/my-posts")?"mine":"saved";return e.jsx(e.Fragment,{children:e.jsx(re,{value:o,onValueChange:p=>{g(`/community/${{all:"all-posts",mine:"my-posts",saved:"bookmarks"}[p]}`)},className:"w-full pl-8",children:e.jsxs(ie,{className:"bg-white/30 backdrop-blur-md ",children:[e.jsx(E,{value:"all",className:"data-[state=active]:bg-red-500 data-[state=active]:text-white dark:data-[state=active]:bg-[#0a0a0a] dark:data-[state=active]:text-white rounded-md transition-all",children:"All Posts"}),e.jsx(E,{value:"mine",className:"data-[state=active]:bg-red-500 data-[state=active]:text-white dark:data-[state=active]:bg-[#0a0a0a] dark:data-[state=active]:text-white rounded-md transition-all",children:"My Posts"}),e.jsx(E,{value:"saved",className:"data-[state=active]:bg-red-500 data-[state=active]:text-white dark:data-[state=active]:bg-[#0a0a0a] dark:data-[state=active]:text-white rounded-md transition-all",children:"Bookmarks"})]})})})}function ge(){const{pathname:n}=R();return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx(oe,{currentPath:n}),e.jsxs("div",{className:"flex-1 overflow-y-auto mt-2",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(V,{})}),e.jsx(ne,{})]})]})}export{ge as default};
